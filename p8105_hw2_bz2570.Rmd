---
title: "p8105_hw2_bz2570"
author: "Boran Zhai"
date: "2025-09-30"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(readr)
library(readxl)
library(lubridate)
```

## Problem 1

#### (1) Clean the data in pols-month.csv
Use separate() to break up the variable mon into integer variables year, month, and day; replace month number with month name; create a president variable taking values gop and dem, and remove prez_dem and prez_gop; and remove the day variable.
```{r}
pols_month <- read_csv("./data/pols-month.csv") |> 
  janitor::clean_names() |>
  separate(mon, into = c("year", "month", "day"), sep = "-") |>
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    day = as.integer(day),
    month = month.abb[month],
    president = ifelse(prez_gop == 1, "gop", 
                       ifelse(prez_dem == 1, "dem",NA))
  ) |>
  select(-prez_dem, -prez_gop, -day)
pols_month
```

#### (2) Clean the data in snp.csv 
using a similar process to the above. For consistency across datasets, arrange according to year and month, and organize so that year and month are the leading columns.
```{r}
snp <- read_csv("./data/snp.csv") |> 
  janitor::clean_names() |> 
  separate(date, into = c("month", "day", "year"), sep = "/") |> 
  mutate(
    year = as.integer(year),
    year = ifelse(year >= 50, 1900 + year, 2000 + year),
    month = as.integer(month),
    day = as.integer(day),
    month = month.abb[month]
  ) |>
  select(year,month,close) |>
  arrange(year, match(month, month.abb))
snp
```

#### (3) Tidy the unemployment data
This process will involve switching from “wide” to “long” format; ensuring that key variables have the same name; and ensuring that key variables take the same values.
```{r}
unemployment_tidy <- read_csv("./data/unemployment.csv") |> 
  pivot_longer(
    Jan:Dec,
    names_to = "month",
    values_to = "unemployment_rate"
  ) |>
  mutate(
    unemployment_rate = as.numeric(unemployment_rate)
  ) |>
  rename(year = Year)
unemployment_tidy 
```

#### (4) Join the datasets by merging snp into pols, and merging unemployment into the result.
```{r}
data_0 <- pols_month |>
  left_join(snp, by = c("year", "month")) |>
  left_join(unemployment_tidy, by = c("year", "month")) |>
  arrange(year, match(month, month.abb))
data_0
```

Note(useing date variable)
```{r}
data_1 <- pols_month |>
  left_join(snp, by = c("year", "month")) |>
  left_join(unemployment_tidy, by = c("year", "month")) |>
  mutate(date = str_c(year, "-", sprintf("%02d", match(month, month.abb))))|> 
  relocate(date) |> 
  select(-year,-month) |> 
  arrange(date)
data_1
```

#### Write a short paragraph about these datasets. 
The final dataset combines three datasets tracking political and economic indicators. After cleaning and tidying three dataset separately, the pols-month dataset contains 822 observations of 9 variables related to the number of national politicians who are democratic or republican at any given time, including presidential party indicators and counts of politicians across governors, senators, and representatives; The snp dataset contains 787 observations of 3 variables related to Standard & Poor's stock market index, including the year and month of observation and closing values of the S&P stock index; The unemployment dataset contains 816 observations of 3 variables related to monthly unemployment percentages across different years, including the year of measurement and unemployment rates for each month from January to December. After merging three datasets, the resulting dataset contains 822 observations monthly spanning from 1947 to 2015 across 11 variables. Key variables include year, month, political composition indicators (gov_gop, sen_gop, rep_gop, gov_dem, sen_dem, rep_dem), presidential party, S&P closing values, unemployment rates. However, while the political data covers the full 1947-2015 period, the economic indicators have some missing values in earlier years, with S&P data beginning in 1950 and unemployment data in 1948. 


## Problem 2

#### (1)
Read and clean the Mr. Trash Wheel sheet
1)specify the sheet in the Excel file and to omit non-data entries using arguments in read_excel
2)use reasonable variable names
3)omit rows that do not include dumpster-specific data
4)round the number of sports balls to the nearest integer and converts the result to an integer variable (using as.integer)
```{r}
mr_tidy <- read_excel("./data/202509 Trash Wheel Collection Data.xlsx", 
                       sheet = "Mr. Trash Wheel",
                       skip = 1,
                       na = c(".", "NA", "")) |>  
  janitor::clean_names() |>  
  filter(!is.na(dumpster)) |> 
  mutate(
    sports_balls = as.integer(round(sports_balls)), 
    year = as.integer(year)
  )

```

#### (2)
Use a similar process to import, clean, and organize the data for Professor Trash Wheel and Gwynnda, and combine this with the Mr. Trash Wheel dataset to produce a single tidy dataset. To keep track of which Trash Wheel is which, you may need to add an additional variable to both datasets before combining.

Read and clean Professor Trash Wheel data
```{r}
professor_tidy <- read_excel("./data/202509 Trash Wheel Collection Data.xlsx",
                        sheet = "Professor Trash Wheel",
                        skip = 1,
                        na = c(".", "NA", "")) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster)) |> 
  mutate(
    year = as.integer(year)
  )
professor_tidy
```

Read and clean Gwynnda data
```{r}
gwynnda_tidy <- read_excel("./data/202509 Trash Wheel Collection Data.xlsx",
                     sheet = "Gwynns Falls Trash Wheel",
                     skip = 1,
                     na = c(".", "NA", "")) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster)) |> 
  mutate(
    year = as.integer(year)
  )
gwynnda_tidy
```

Add an additional variable to both datasets before combining
```{r}
mr_tidy <- mr_tidy |> 
  mutate(trash_wheel = "Mr. Trash Wheel")
professor_tidy <- professor_tidy |> 
  mutate(trash_wheel = "Professor Trash Wheel")
gwynnda_tidy <- gwynnda_tidy |> 
  mutate(trash_wheel = "Gwynnda")
mr_tidy
```

Combine this with the Mr. Trash Wheel dataset to produce a single tidy dataset
```{r}
combined_trash <- bind_rows(mr_tidy, professor_tidy, gwynnda_tidy) |> 
  select(where(~!all(is.na(.)))) |> 
  arrange(date)
combined_trash
```


#### Write a paragraph about these data
The resulting dataset combines trash collection data from three separate devices operating in Baltimore's Inner Harbor: Mr. Trash Wheel, Professor Trash Wheel, and Gwynns Falls Trash Wheel. The resulting dataset contains `r nrow(combined_trash)` observations tracking waste collection with `r ncol(combined_trash)` variables. Key variables include dumpster identification numbers, collection dates, total weight of trash, the number of some specific waste categories such as plastic bottles, polystyrene, cigarette butts, and the trash wheel identifier to track the source device.<br>(All the variables are:`r paste(names(combined_trash), collapse = ", ")`).<br> Based on the available data, the total weight of trash collected by Professor Trash Wheel is `r combined_trash |> filter(trash_wheel == "Professor Trash Wheel") |> summarise(total = sum(weight_tons, na.rm = TRUE)) |> pull(total)` tons. During June 2022, Gwynnda collected `r combined_trash |> filter(trash_wheel == "Gwynnda", year == 2022, month == "June") |> summarise(total = sum(cigarette_butts, na.rm = TRUE)) |> pull(total)` cigarette butts.
